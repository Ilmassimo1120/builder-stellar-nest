<svg viewBox="0 0 1400 900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .box { fill: #f0f9ff; stroke: #0891b2; stroke-width: 2; }
      .box-header { fill: #0891b2; color: white; font-size: 14px; font-weight: bold; }
      .box-content { fill: white; color: #333; font-size: 11px; }
      .text { font-family: Arial, sans-serif; }
      .layer-title { font-size: 18px; font-weight: bold; fill: #0891b2; }
      .connection { stroke: #059669; stroke-width: 2; fill: none; }
      .arrow { fill: #059669; }
      .section { fill: #f9fafb; stroke: #ddd; stroke-width: 1; }
      .integration-ready { fill: #d1fae5; stroke: #10b981; stroke-width: 1.5; }
      .integration-partial { fill: #fef3c7; stroke: #f59e0b; stroke-width: 1.5; }
      .integration-stub { fill: #fee2e2; stroke: #ef4444; stroke-width: 1.5; }
      .status-label { font-size: 10px; font-weight: bold; }
    </style>
  </defs>

  <!-- Title -->
  <text x="700" y="30" class="text" text-anchor="middle" font-size="24" font-weight="bold" fill="#0891b2">
    ChargeSource Architecture Diagram
  </text>
  <text x="700" y="50" class="text" text-anchor="middle" font-size="12" fill="#666">
    EV Infrastructure Platform for Australian Electrical Contractors
  </text>

  <!-- LAYER 1: CLIENT (React) -->
  <text x="20" y="90" class="text layer-title">CLIENT LAYER (React 18 + TypeScript + Vite)</text>

  <!-- Client Box -->
  <rect x="20" y="100" width="1360" height="140" class="section" rx="4"/>
  
  <!-- Frontend Components -->
  <rect x="40" y="115" width="120" height="110" class="box" rx="3"/>
  <text x="50" y="135" class="text box-header" text-anchor="start">Pages</text>
  <text x="50" y="155" class="text box-content">‚Ä¢ Dashboard</text>
  <text x="50" y="170" class="text box-content">‚Ä¢ Projects</text>
  <text x="50" y="185" class="text box-content">‚Ä¢ Quotes</text>
  <text x="50" y="200" class="text box-content">‚Ä¢ Analytics</text>

  <rect x="180" y="115" width="120" height="110" class="box" rx="3"/>
  <text x="190" y="135" class="text box-header" text-anchor="start">Components</text>
  <text x="190" y="155" class="text box-content">‚Ä¢ UI Library (Radix)</text>
  <text x="190" y="170" class="text box-content">‚Ä¢ Project Wizard</text>
  <text x="190" y="185" class="text box-content">‚Ä¢ Quote Builder</text>
  <text x="190" y="200" class="text box-content">‚Ä¢ Client Portal</text>

  <rect x="320" y="115" width="120" height="110" class="box" rx="3"/>
  <text x="330" y="135" class="text box-header" text-anchor="start">State Mgmt</text>
  <text x="330" y="155" class="text box-content">‚Ä¢ useAuth Hook</text>
  <text x="330" y="170" class="text box-content">‚Ä¢ React Query</text>
  <text x="330" y="185" class="text box-content">‚Ä¢ TanStack</text>
  <text x="330" y="200" class="text box-content">‚Ä¢ Context API</text>

  <rect x="460" y="115" width="120" height="110" class="box" rx="3"/>
  <text x="470" y="135" class="text box-header" text-anchor="start">Services</text>
  <text x="470" y="155" class="text box-content">‚Ä¢ projectService</text>
  <text x="470" y="170" class="text box-content">‚Ä¢ quoteService</text>
  <text x="470" y="185" class="text box-content">‚Ä¢ fileStorage</text>
  <text x="470" y="200" class="text box-content">‚Ä¢ authentication</text>

  <rect x="600" y="115" width="120" height="110" class="box" rx="3"/>
  <text x="610" y="135" class="text box-header" text-anchor="start">Styling</text>
  <text x="610" y="155" class="text box-content">‚Ä¢ TailwindCSS 3</text>
  <text x="610" y="170" class="text box-content">‚Ä¢ Radix UI</text>
  <text x="610" y="185" class="text box-content">‚Ä¢ custom.css</text>
  <text x="610" y="200" class="text box-content">‚Ä¢ cn() utility</text>

  <rect x="740" y="115" width="120" height="110" class="box" rx="3"/>
  <text x="750" y="135" class="text box-header" text-anchor="start">Optimization</text>
  <text x="750" y="155" class="text box-content">‚Ä¢ Code splitting</text>
  <text x="750" y="170" class="text box-content">‚Ä¢ Lazy loading</text>
  <text x="750" y="185" class="text box-content">‚Ä¢ Bundle analysis</text>
  <text x="750" y="200" class="text box-content">‚Ä¢ Caching</text>

  <rect x="880" y="115" width="150" height="110" class="box" rx="3"/>
  <text x="890" y="135" class="text box-header" text-anchor="start">Testing</text>
  <text x="890" y="155" class="text box-content">‚Ä¢ Vitest</text>
  <text x="890" y="170" class="text box-content">‚Ä¢ React Testing Library</text>
  <text x="890" y="185" class="text box-content">‚Ä¢ Mock Supabase</text>
  <text x="890" y="200" class="text box-content">‚Ä¢ Unit/Integration Tests</text>

  <rect x="1050" y="115" width="120" height="110" class="box" rx="3"/>
  <text x="1060" y="135" class="text box-header" text-anchor="start">Build</text>
  <text x="1060" y="155" class="text box-content">‚Ä¢ Vite 6</text>
  <text x="1060" y="170" class="text box-content">‚Ä¢ TypeScript</text>
  <text x="1060" y="185" class="text box-content">‚Ä¢ ESBuild</text>
  <text x="1060" y="200" class="text box-content">‚Ä¢ HMR Support</text>

  <!-- ARROW DOWN -->
  <path d="M 700 250 L 700 290" class="connection" marker-end="url(#arrowhead)"/>
  <text x="705" y="275" class="text" font-size="10" fill="#059669">HTTP/REST API</text>

  <!-- LAYER 2: EXPRESS SERVER -->
  <text x="20" y="310" class="text layer-title">SERVER LAYER (Express.js + Node.js)</text>

  <rect x="20" y="320" width="1360" height="120" class="section" rx="4"/>

  <rect x="40" y="335" width="130" height="95" class="box" rx="3"/>
  <text x="50" y="355" class="text box-header" text-anchor="start">Auth Routes</text>
  <text x="50" y="375" class="text box-content">‚Ä¢ /auth/login</text>
  <text x="50" y="390" class="text box-content">‚Ä¢ /auth/register</text>
  <text x="50" y="405" class="text box-content">‚Ä¢ /auth/callback</text>

  <rect x="190" y="335" width="130" height="95" class="box" rx="3"/>
  <text x="200" y="355" class="text box-header" text-anchor="start">API Routes</text>
  <text x="200" y="375" class="text box-content">‚Ä¢ /projects</text>
  <text x="200" y="390" class="text box-content">‚Ä¢ /quotes</text>
  <text x="200" y="405" class="text box-content">‚Ä¢ /files</text>

  <rect x="340" y="335" width="130" height="95" integration-ready rx="3"/>
  <text x="350" y="355" class="text box-header" text-anchor="start">CRM Routes</text>
  <text x="350" y="375" class="text box-content" fill="#10b981">‚Ä¢ /crm/leads</text>
  <text x="350" y="390" class="text box-content status-label" fill="#f59e0b">‚ö†Ô∏è Stub</text>
  <text x="350" y="405" class="text box-content">‚Ä¢ Demo submission</text>

  <rect x="490" y="335" width="130" height="95" integration-stub rx="3"/>
  <text x="500" y="355" class="text box-header" text-anchor="start">Email Routes</text>
  <text x="500" y="375" class="text box-content" fill="#ef4444">‚Ä¢ /email/send</text>
  <text x="500" y="390" class="text box-content status-label" fill="#ef4444">‚ùå Stub</text>
  <text x="500" y="405" class="text box-content">‚Ä¢ Simulated only</text>

  <rect x="640" y="335" width="130" height="95" class="box" rx="3"/>
  <text x="650" y="355" class="text box-header" text-anchor="start">Storage Routes</text>
  <text x="650" y="375" class="text box-content">‚Ä¢ /buckets/create</text>
  <text x="650" y="390" class="text box-content">‚Ä¢ /health</text>
  <text x="650" y="405" class="text box-content">‚Ä¢ /api/demo</text>

  <rect x="790" y="335" width="130" height="95" class="box" rx="3"/>
  <text x="800" y="355" class="text box-header" text-anchor="start">Middleware</text>
  <text x="800" y="375" class="text box-content">‚Ä¢ CORS</text>
  <text x="800" y="390" class="text box-content">‚Ä¢ Auth check</text>
  <text x="800" y="405" class="text box-content">‚Ä¢ Error handling</text>

  <rect x="940" y="335" width="150" height="95" class="box" rx="3"/>
  <text x="950" y="355" class="text box-header" text-anchor="start">Serverless Wrapper</text>
  <text x="950" y="375" class="text box-content">‚Ä¢ Netlify Functions</text>
  <text x="950" y="390" class="text box-content">‚Ä¢ serverless-http</text>
  <text x="950" y="405" class="text box-content">‚Ä¢ Event adapters</text>

  <rect x="1110" y="335" width="130" height="95" class="box" rx="3"/>
  <text x="1120" y="355" class="text box-header" text-anchor="start">Config</text>
  <text x="1120" y="375" class="text box-content">‚Ä¢ Environment vars</text>
  <text x="1120" y="390" class="text box-content">‚Ä¢ Feature flags</text>
  <text x="1120" y="405" class="text box-content">‚Ä¢ API keys</text>

  <!-- ARROW DOWN -->
  <path d="M 700 445 L 700 485" class="connection" marker-end="url(#arrowhead)"/>
  <text x="730" y="470" class="text" font-size="10" fill="#059669">Query/Mutation</text>

  <!-- LAYER 3: BACKEND SERVICES -->
  <text x="20" y="505" class="text layer-title">BACKEND SERVICES (Supabase + Edge Functions)</text>

  <rect x="20" y="515" width="1360" height="200" class="section" rx="4"/>

  <!-- PostgreSQL Database -->
  <rect x="40" y="530" width="140" height="175" class="integration-ready" rx="3"/>
  <text x="50" y="550" class="text box-header" text-anchor="start">PostgreSQL</text>
  <text x="50" y="570" class="text box-content">Tables:</text>
  <text x="50" y="585" class="text box-content">‚Ä¢ users</text>
  <text x="50" y="600" class="text box-content">‚Ä¢ projects</text>
  <text x="50" y="615" class="text box-content">‚Ä¢ quotes</text>
  <text x="50" y="630" class="text box-content">‚Ä¢ file_assets</text>
  <text x="50" y="645" class="text box-content">‚Ä¢ global_settings</text>
  <text x="50" y="660" class="text box-content">‚Ä¢ attachments</text>
  <text x="50" y="675" class="text box-content">RLS Policies</text>

  <!-- Supabase Auth -->
  <rect x="200" y="530" width="140" height="175" class="integration-ready" rx="3"/>
  <text x="210" y="550" class="text box-header" text-anchor="start">Supabase Auth</text>
  <text x="210" y="570" class="text box-content">‚Ä¢ JWT tokens</text>
  <text x="210" y="585" class="text box-content">‚Ä¢ Email/Password</text>
  <text x="210" y="600" class="text box-content">‚Ä¢ OAuth (Google)</text>
  <text x="210" y="615" class="text box-content">‚Ä¢ Session mgmt</text>
  <text x="210" y="630" class="text box-content">‚Ä¢ Token refresh</text>
  <text x="210" y="645" class="text box-content">‚Ä¢ Password reset</text>
  <text x="210" y="660" class="text box-content">‚Ä¢ User profiles</text>
  <text x="210" y="675" class="text box-content">‚Ä¢ Roles/Permissions</text>

  <!-- Supabase Storage -->
  <rect x="360" y="530" width="140" height="175" integration-partial rx="3"/>
  <text x="370" y="550" class="text box-header" text-anchor="start">Storage (S3)</text>
  <text x="370" y="570" class="text box-content">Buckets:</text>
  <text x="370" y="585" class="text box-content">‚Ä¢ documents</text>
  <text x="370" y="600" class="text box-content">‚Ä¢ user-files</text>
  <text x="370" y="615" class="text box-content">‚Ä¢ videos</text>
  <text x="370" y="630" class="text box-content">‚ö†Ô∏è Not auto-created</text>
  <text x="370" y="645" class="text box-content">Signed URLs</text>
  <text x="370" y="660" class="text box-content">RLS Buckets</text>
  <text x="370" y="675" class="text box-content">Versioning</text>

  <!-- Edge Functions -->
  <rect x="520" y="530" width="140" height="175" integration-partial rx="3"/>
  <text x="530" y="550" class="text box-header" text-anchor="start">Edge Funcs (Deno)</text>
  <text x="530" y="570" class="text box-content">‚ö†Ô∏è Stubs:</text>
  <text x="530" y="585" class="text box-content">‚Ä¢ file-upload</text>
  <text x="530" y="600" class="text box-content">‚Ä¢ file-list</text>
  <text x="530" y="615" class="text box-content">‚Ä¢ file-delete</text>
  <text x="530" y="630" class="text box-content">‚Ä¢ generate-pdf</text>
  <text x="530" y="645" class="text box-content">‚Ä¢ calc-totals</text>
  <text x="530" y="660" class="text box-content">Not deployed</text>
  <text x="530" y="675" class="text box-content">Requires keys</text>

  <!-- Realtime (Optional) -->
  <rect x="680" y="530" width="140" height="175" class="box" rx="3"/>
  <text x="690" y="550" class="text box-header" text-anchor="start">Realtime (Optional)</text>
  <text x="690" y="570" class="text box-content">‚Ä¢ WebSocket</text>
  <text x="690" y="585" class="text box-content">‚Ä¢ Subscriptions</text>
  <text x="690" y="600" class="text box-content">‚Ä¢ Live updates</text>
  <text x="690" y="615" class="text box-content">‚Ä¢ Presence</text>
  <text x="690" y="630" class="text box-content">Not implemented</text>
  <text x="690" y="645" class="text box-content">For future:</text>
  <text x="690" y="660" class="text box-content">‚Ä¢ Quote collab</text>
  <text x="690" y="675" class="text box-content">‚Ä¢ Live project sync</text>

  <!-- Database Functions -->
  <rect x="840" y="530" width="140" height="175" class="box" rx="3"/>
  <text x="850" y="550" class="text box-header" text-anchor="start">DB Functions</text>
  <text x="850" y="570" class="text box-content">‚Ä¢ calc_quote_total</text>
  <text x="850" y="585" class="text box-content">‚Ä¢ apply_discounts</text>
  <text x="850" y="600" class="text box-content">‚Ä¢ update_gst</text>
  <text x="850" y="615" class="text box-content">‚Ä¢ archive_project</text>
  <text x="850" y="630" class="text box-content">‚Ä¢ validate_compliance</text>
  <text x="850" y="645" class="text box-content">RLS-protected</text>
  <text x="850" y="660" class="text box-content">Audit logging</text>
  <text x="850" y="675" class="text box-content">Transaction support</text>

  <!-- Connection Config -->
  <rect x="1000" y="530" width="140" height="175" class="box" rx="3"/>
  <text x="1010" y="550" class="text box-header" text-anchor="start">Config & Setup</text>
  <text x="1010" y="570" class="text box-content">Scripts:</text>
  <text x="1010" y="585" class="text box-content">‚Ä¢ setup-supabase.js</text>
  <text x="1010" y="600" class="text box-content">‚Ä¢ create-buckets.js</text>
  <text x="1010" y="615" class="text box-content">‚Ä¢ setup-storage.js</text>
  <text x="1010" y="630" class="text box-content">Requires:</text>
  <text x="1010" y="645" class="text box-content">‚Ä¢ SERVICE_ROLE_KEY</text>
  <text x="1010" y="660" class="text box-content">‚Ä¢ SUPABASE_URL</text>
  <text x="1010" y="675" class="text box-content">Manual execution</text>

  <!-- Deployment Options -->
  <rect x="1160" y="530" width="140" height="175" class="box" rx="3"/>
  <text x="1170" y="550" class="text box-header" text-anchor="start">Deployment</text>
  <text x="1170" y="570" class="text box-content">Options:</text>
  <text x="1170" y="585" class="text box-content">‚Ä¢ Netlify (current)</text>
  <text x="1170" y="600" class="text box-content">‚Ä¢ Vercel</text>
  <text x="1170" y="615" class="text box-content">‚Ä¢ Self-hosted</text>
  <text x="1170" y="630" class="text box-content">Auto-scaling</text>
  <text x="1170" y="645" class="text box-content">Environment vars</text>
  <text x="1170" y="660" class="text box-content">CI/CD ready</text>
  <text x="1170" y="675" class="text box-content">Multi-region</text>

  <!-- ARROW DOWN -->
  <path d="M 700 720 L 700 760" class="connection" marker-end="url(#arrowhead)"/>
  <text x="730" y="745" class="text" font-size="10" fill="#059669">API Integration</text>

  <!-- LAYER 4: EXTERNAL INTEGRATIONS -->
  <text x="20" y="780" class="text layer-title">EXTERNAL INTEGRATIONS (3rd-Party APIs)</text>

  <rect x="20" y="790" width="1360" height="90" class="section" rx="4"/>

  <!-- Accounting -->
  <rect x="40" y="805" width="110" height="60" integration-stub rx="3"/>
  <text x="50" y="820" class="text box-header" text-anchor="start">Accounting</text>
  <text x="50" y="835" class="text box-content">‚ùå Xero</text>
  <text x="50" y="850" class="text box-content">‚ùå MYOB</text>

  <!-- CRM -->
  <rect x="170" y="805" width="110" height="60" integration-partial rx="3"/>
  <text x="180" y="820" class="text box-header" text-anchor="start">CRM</text>
  <text x="180" y="835" class="text box-content">‚ö†Ô∏è HubSpot</text>
  <text x="180" y="850" class="text box-content">‚ö†Ô∏è Pipedrive</text>

  <!-- Email/Communication -->
  <rect x="300" y="805" width="110" height="60" integration-stub rx="3"/>
  <text x="310" y="820" class="text box-header" text-anchor="start">Email/Comms</text>
  <text x="310" y="835" class="text box-content">‚ùå SendGrid</text>
  <text x="310" y="850" class="text box-content">‚ùå Slack</text>

  <!-- Payments -->
  <rect x="430" y="805" width="110" height="60" integration-partial rx="3"/>
  <text x="440" y="820" class="text box-header" text-anchor="start">Payments</text>
  <text x="440" y="835" class="text box-content">‚ö†Ô∏è Stripe</text>
  <text x="440" y="850" class="text box-content">‚ö†Ô∏è PayPal</text>

  <!-- Maps -->
  <rect x="560" y="805" width="110" height="60" integration-partial rx="3"/>
  <text x="570" y="820" class="text box-header" text-anchor="start">Maps/Geo</text>
  <text x="570" y="835" class="text box-content">‚ö†Ô∏è Google Maps</text>
  <text x="570" y="850" class="text box-content">‚ùå Geocoding</text>

  <!-- Analytics -->
  <rect x="690" y="805" width="110" height="60" class="box" rx="3"/>
  <text x="700" y="820" class="text box-header" text-anchor="start">Analytics</text>
  <text x="700" y="835" class="text box-content">üîÑ Sentry</text>
  <text x="700" y="850" class="text box-content">üîÑ Segment</text>

  <!-- Monitoring -->
  <rect x="820" y="805" width="110" height="60" class="box" rx="3"/>
  <text x="830" y="820" class="text box-header" text-anchor="start">Monitoring</text>
  <text x="830" y="835" class="text box-content">‚Ä¢ Uptime</text>
  <text x="830" y="850" class="text box-content">‚Ä¢ Performance</text>

  <!-- Storage Backup -->
  <rect x="950" y="805" width="110" height="60" class="box" rx="3"/>
  <text x="960" y="820" class="text box-header" text-anchor="start">Backup/CDN</text>
  <text x="960" y="835" class="text box-content">‚Ä¢ AWS S3</text>
  <text x="960" y="850" class="text box-content">‚Ä¢ Cloudflare CDN</text>

  <!-- Project Tools -->
  <rect x="1080" y="805" width="110" height="60" class="box" rx="3"/>
  <text x="1090" y="820" class="text box-header" text-anchor="start">Project Mgmt</text>
  <text x="1090" y="835" class="text box-content">üîÑ Asana</text>
  <text x="1090" y="850" class="text box-content">üîÑ Monday</text>

  <!-- Supplier APIs -->
  <rect x="1210" y="805" width="110" height="60" class="box" rx="3"/>
  <text x="1220" y="820" class="text box-header" text-anchor="start">Suppliers</text>
  <text x="1220" y="835" class="text box-content">üîÑ Charger APIs</text>
  <text x="1220" y="850" class="text box-content">üîÑ Pricing Feeds</text>

  <!-- Legend -->
  <rect x="20" y="910" width="1360" height="1" class="section"/>
  <text x="20" y="925" class="text" font-size="11" fill="#666">
    Legend: ‚úÖ Working | ‚ö†Ô∏è Partial/Stub | ‚ùå Non-functional | üîÑ Planned
  </text>

  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" class="arrow"/>
    </marker>
  </defs>
</svg>
